# DinamicHUD (Project Antigravity)

**DinamicHUD** — это профессиональный Heads-Up Display (HUD) для покера, разработанный специально для macOS. Приложение в реальном времени анализирует историю раздач, рассчитывает статистику игроков и отображает её непосредственно поверх игровых столов PokerStars.

## Обзор проекта

Проект решает задачу предоставления игроку мгновенной статистической информации об оппонентах во время игры. Основной функционал включает:
- **Мониторинг в реальном времени:** Отслеживание новых файлов истории раздач и мгновенный парсинг обновлений.
- **Расчет статистики:** VPIP, PFR, 3-Bet, Fold to 3-Bet, Aggression и другие метрики.
- **Оверлей:** Отображение статистики рядом с аватарами игроков с цветовым кодированием (Heatmap).
- **Динамическая база данных:** Использование SQLite для хранения и агрегации данных.
- **Визуализация:** Графики (Net Won, EV Adjusted) и матрицы стартовых рук.

## Структура проекта

* **`main.py`** — Точка входа в приложение. Управляет окнами HUD, привязкой к столам и жизненным циклом приложения.
* **`poker_monitor.py`** — "Слушатель" файловой системы. Отвечает за обнаружение обновлений в файлах истории раздач.
* **`poker_stats_db.py`** — Слой работы с базой данных (SQLite) и математическое ядро для расчета статистики и эквити.
* **`my_pokerkit_parser.py`** — Кастомный парсер истории раздач PokerStars, оптимизированный под форматы рума.
* **`personal_stats_hud.py`** — Окно расширенной статистики для "Хиро" (пользователя), включая графики и таблицы.
* **`graph_widget.py`** — Виджеты для отрисовки графиков профита и EV.
* **`hand_matrix_widget.py`** — Визуализация диапазонов рук (матрица 13x13).
* **`macos_window_utils.py`** — Утилиты для взаимодействия с оконной системой macOS (получение координат окон).
* **`setup_test_env.py`** — Скрипт подготовки тестового окружения (копирование истории раздач).
* **`run_tests.py`** — Скрипт запуска интеграционных тестов и проверки целостности данных.

## Установка и запуск

### Предварительные требования
* Python 3.10+
* macOS (из-за использования специфичных API для окон)

### Установка зависимостей
Рекомендуется использовать виртуальное окружение:

```bash
python3 -m venv venv
source venv/bin/activate
pip install PySide6 pokerkit pandas pywinctl
```

### Запуск проекта
Для запуска HUD используйте команду:

```bash
python main.py
```

Опциональные аргументы:
* `--load-all [DIR]` — Загрузить всю историю из указанной директории в базу данных, не запуская HUD.

### Переменные окружения
Проект не требует обязательных переменных окружения, но использует путь к истории раздач PokerStars, который обычно находится в `~/Library/Application Support/PokerStars/HandHistory/`.

## Процесс тестирования

Проект содержит набор интеграционных тестов, которые проверяют весь пайплайн: от парсинга файла до расчета EV в базе данных.

### Как запустить тесты
1. Подготовьте тестовые данные (скопирует реальные файлы истории):
   ```bash
   python setup_test_env.py
   ```
2. Запустите тесты:
   ```bash
   python run_tests.py
   ```

### Покрытие тестов
Тесты проверяют:
* Корректность парсинга файлов PokerStars.
* Сохранение данных в SQLite.
* Отсутствие `NULL` значений в расчетах Profit/EV.
* Корректность пересчета статистики (VPIP/PFR) при полной перезагрузке.
